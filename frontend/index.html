<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>eatwhileworking</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 24px;
      background: #fafafa;
    }
    h1 { font-size: 24px; margin-bottom: 16px; }
    button {
      padding: 12px 16px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 16px;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .name { font-weight: bold; font-size: 18px; }
    .price { color: #666; margin: 4px 0; }
    .reason { margin-top: 8px; }
    .hint { font-size: 14px; color: #888; margin-bottom: 12px; }
  </style>
</head>
<body>

<h1>eatwhileworking</h1>

<div style="margin-bottom:16px;">
  <label><input type="radio" name="people" value="1" checked /> ä¸€å€‹äºº</label>
  <label><input type="radio" name="people" value="2-4" /> 2â€“4 äºº</label>
  <label><input type="radio" name="people" value="5+" /> 5 äººä»¥ä¸Š</label>
</div>

<div class="hint">ğŸ“ é è¨­ä½ç½®ï¼šå°åŒ—å¸‚ï¼ˆç©©å®šæ¨¡å¼ï¼‰</div>

<button id="recommendBtn">å¹«æˆ‘æƒ³åƒä»€éº¼</button>

<div id="results"></div>

<script>
const DEFAULT_LOCATION = { lat: 25.0330, lng: 121.5654 };
const resultsEl = document.getElementById("results");
const btn = document.getElementById("recommendBtn");

const CORS_PROXY = "https://api.allorigins.win/raw?url=";
const OVERPASS_API = "https://overpass-api.de/api/interpreter";

// å‚™ç”¨è³‡æ–™ï¼ˆä¿éšªï¼‰
const FALLBACK = [
  { name: "é™„è¿‘å°åƒåº—", cuisine: "å®¶å¸¸æ–™ç†" },
  { name: "ä¾¿ç•¶åº—", cuisine: "å°å¼" },
  { name: "å’–å“©é£¯", cuisine: "æ—¥å¼" }
];

async function fetchNearbyRestaurants() {
  const { lat, lng } = DEFAULT_LOCATION;

  const query = `
    [out:json][timeout:10];
    node["amenity"="restaurant"]
      (around:400, ${lat}, ${lng});
    out 8;
  `;

  const response = await fetch(
    CORS_PROXY + encodeURIComponent(OVERPASS_API),
    { method: "POST", body: query }
  );

  const data = await response.json();

  return data.elements
    .filter(el => el.tags?.name)
    .map(el => ({
      name: el.tags.name,
      cuisine: el.tags.cuisine || "æ–™ç†"
    }));
}

function reason(people, cuisine) {
  if (people === "1") return `ä¸€å€‹äººä¹Ÿèˆ’æœçš„ ${cuisine}`;
  if (people === "2-4") return `æœ‹å‹ä¸€èµ·åƒçš„ ${cuisine}`;
  return `å¤šäººèšé¤é©åˆçš„ ${cuisine}`;
}

btn.addEventListener("click", async () => {
  resultsEl.textContent = "æ­£åœ¨æ€è€ƒä¸­â€¦";

  const people = document.querySelector(
    'input[name="people"]:checked'
  ).value;

  try {
    const list = await fetchNearbyRestaurants();
    render(list.length ? list : FALLBACK, people);
  } catch {
    render(FALLBACK, people);
  }
});

function render(list, people) {
  resultsEl.innerHTML = "";
  list.forEach(r => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="name">${r.name}</div>
      <div class="price">åƒ¹ä½ï¼šä¾åº—å®¶</div>
      <div class="reason">${reason(people, r.cuisine)}</div>
    `;
    resultsEl.appendChild(div);
  });
}
</script>

</body>
</html>
